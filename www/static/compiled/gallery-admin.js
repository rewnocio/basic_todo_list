// Generated by CoffeeScript 1.6.3
$(document).ready(function() {
  $('ul.photos').on('click', 'button.delete-img', function(e) {
    return $(e.currentTarget).parents('li').remove();
  });
  $('#new-photo').click(function(event) {
    var html;
    html = _.template($('#photo-template').html(), {
      index: $('ul.photos li').length + 1
    });
    return $('ul.photos').append(html).sortable();
  });
  return $('#save-gallery').click(function(event) {
    var pics, title;
    title = $('[name=title]').val();
    pics = [];
    $('.get-photo').each(function() {
      var src;
      src = $(this).attr('src');
      if (src.indexOf('static/upload') > 0) {
        return pics.push(src);
      }
    });
    if (title === '' || pics.length === 0) {
      return Datafly.error('You need to specify title and upload at least one image');
    }
    $.ajax({
      url: '/admin/api/gallery',
      data: JSON.stringify({
        'data': {
          'id': $('[name=id]').val(),
          'title': title,
          'desc': $('[name=desc]').val(),
          'pics': pics
        }
      }),
      type: 'POST',
      dataType: 'json',
      contentType: 'application/json'
    }).done(function(data) {
      return $('[name=id]').attr('value', data.id);
    });
    return Datafly.notify('Saved!');
  });
});
